# Kratix Kind Development Playground Configuration
# ================================================
# This file centralises all configurable values for the Kratix setup scripts.
# Source this file in scripts: source "$(dirname "$0")/config.env"
#
# To use a different configuration, copy this file and modify as needed,
# then set CONFIG_FILE environment variable before running scripts.

# =============================================================================
# VERSION CONFIGURATION
# =============================================================================
# Pin versions to ensure reproducible installations.
# Check compatibility before updating versions.

# Kubernetes version for Kind clusters
# See available versions: https://github.com/kubernetes-sigs/kind/releases
K8S_VERSION="v1.35.0"

# Kratix version - use a specific release tag for stability
# Using "latest" is not recommended for production use
# See releases: https://github.com/syntasso/kratix/releases
KRATIX_VERSION="v0.125.0"

# Cert-manager version
# See releases: https://github.com/cert-manager/cert-manager/releases
CERT_MANAGER_VERSION="v1.13.2"

# =============================================================================
# CLUSTER CONFIGURATION
# =============================================================================

# Platform cluster where Kratix runs
PLATFORM_CLUSTER_NAME="platform-cluster"
PLATFORM_CONTEXT="kind-${PLATFORM_CLUSTER_NAME}"

# Worker cluster where workloads are deployed
WORKER_CLUSTER_NAME="worker-cluster"
WORKER_CONTEXT="kind-${WORKER_CLUSTER_NAME}"

# =============================================================================
# NAMESPACE CONFIGURATION
# =============================================================================

# Kratix platform namespace (where Kratix controller and MinIO run)
KRATIX_PLATFORM_NAMESPACE="kratix-platform-system"

# Kratix worker namespace (where Flux resources are configured)
KRATIX_WORKER_NAMESPACE="kratix-worker-system"

# Flux namespace
FLUX_NAMESPACE="flux-system"

# Cert-manager namespace
CERT_MANAGER_NAMESPACE="cert-manager"

# Namespace for MinIO credentials secret on platform cluster
MINIO_SECRET_NAMESPACE="default"

# =============================================================================
# URL CONFIGURATION
# =============================================================================
# These URLs point to installation manifests.
# Consider mirroring these files locally for air-gapped environments.

# Cert-manager installation manifest
CERT_MANAGER_URL="https://github.com/cert-manager/cert-manager/releases/download/${CERT_MANAGER_VERSION}/cert-manager.yaml"

# Kratix installation manifest
KRATIX_URL="https://github.com/syntasso/kratix/releases/download/${KRATIX_VERSION}/kratix.yaml"

# MinIO installation manifest
# Uses main branch as it contains fixes for deprecated container images
# (v0.125.0 uses bitnami/kubectl:1.28.6 which no longer exists on Docker Hub)
MINIO_INSTALL_URL="https://raw.githubusercontent.com/syntasso/kratix/main/config/samples/minio-install.yaml"

# Flux installation manifest for worker clusters
# Pinned to KRATIX_VERSION for consistency (includes Flux v2.3.0 at v0.125.0)
# NOTE: If upgrading Kratix, verify this file exists at the new version tag
FLUX_INSTALL_URL="https://raw.githubusercontent.com/syntasso/kratix/${KRATIX_VERSION}/hack/destination/gitops-tk-install.yaml"

# =============================================================================
# MINIO CONFIGURATION
# =============================================================================

# MinIO bucket name for Kratix state store
MINIO_BUCKET_NAME="kratix"

# MinIO NodePort (must match the port in minio-install.yaml)
MINIO_NODEPORT="31337"

# MinIO credentials secret name
MINIO_SECRET_NAME="minio-credentials"

# MinIO service DNS name within cluster
MINIO_SERVICE_DNS="minio.${KRATIX_PLATFORM_NAMESPACE}.svc.cluster.local"

# =============================================================================
# FLUX CONFIGURATION
# =============================================================================

# Flux reconciliation interval
FLUX_BUCKET_INTERVAL="10s"

# Paths in MinIO bucket for worker cluster resources
# Kratix writes to {destination-name}/resources and {destination-name}/dependencies
# Note: DESTINATION_NAME defaults to WORKER_CLUSTER_NAME
WORKER_DEPENDENCIES_PATH="${WORKER_CLUSTER_NAME}/dependencies"
WORKER_RESOURCES_PATH="${WORKER_CLUSTER_NAME}/resources"

# =============================================================================
# KRATIX RESOURCE CONFIGURATION
# =============================================================================

# BucketStateStore name
BUCKET_STATE_STORE_NAME="default"

# Destination name for worker cluster
DESTINATION_NAME="${WORKER_CLUSTER_NAME}"

# Destination labels (used for Promise scheduling)
DESTINATION_LABEL_KEY="environment"
DESTINATION_LABEL_VALUE="dev"

# =============================================================================
# API VERSION CONFIGURATION
# =============================================================================
# These may need updating when Kratix or Flux graduate APIs to stable versions.

# Kratix API version
KRATIX_API_VERSION="platform.kratix.io/v1alpha1"

# Flux Source API version
FLUX_SOURCE_API_VERSION="source.toolkit.fluxcd.io/v1beta2"

# Flux Kustomize API version
FLUX_KUSTOMIZE_API_VERSION="kustomize.toolkit.fluxcd.io/v1"

# =============================================================================
# TIMEOUT CONFIGURATION
# =============================================================================

# Timeout for Kind cluster creation (seconds)
CLUSTER_CREATE_TIMEOUT="120s"

# Timeout for deployment readiness checks (seconds)
DEPLOYMENT_WAIT_TIMEOUT="300s"

# =============================================================================
# DEPLOYMENT NAMES (for wait conditions)
# =============================================================================
# These are the deployment names checked during installation.
# Update if upstream projects rename their deployments.

# Cert-manager deployments
CERT_MANAGER_DEPLOYMENTS="deployment/cert-manager deployment/cert-manager-cainjector deployment/cert-manager-webhook"

# Kratix deployment
KRATIX_DEPLOYMENT="deployment/kratix-platform-controller-manager"

# MinIO deployment
MINIO_DEPLOYMENT="deployment/minio"

# Flux deployments
FLUX_DEPLOYMENTS="deployment/source-controller deployment/kustomize-controller"
